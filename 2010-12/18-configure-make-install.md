configure; make; make install
===========

翻译一篇文章，我最早从这篇文章中了解到为什么Linux平台上，从源代码安装软件通常都需要这三步：

1. ./configure
1. make
1. make install 。

**译文如下**：

我总是听人们说，通常只要使用configure, make, make install来让程序可以运行。不幸的是大多数现在用电脑的是根本没有使用过compiler，或是写过一行代码。随着图形用户接口(GUI)，应用程序构建工具(application builder)的出现，现在很多真正的程序员也不用configure; make; make install了。

你所要做的有三步，每一步都会使用现有的程序使得一个新的程序就绪或运行。在make之前先要使用configure，但每一步都会有着不同的目的。接来我会解释第二步(make)和第三步(make install)，之后我会再解释configure.

make这个实用工作已经成为Unix历史的一部分了。设计它的主要目的是减少程序员的记忆负担。我猜，更好的说法是它减少了程序员所需编写的文档。在任何情况下，一旦你建立了一套make可以理解的规则去创建一个程序，你就不用再惦记着他们(这套规则)了。

为了让这些工作变得简单，make实用工具有一套内建的规则，你只要告诉make构建你的程序所需的规则。举例来说，你输入了make love，make会根据你的输入寻找一些规则，如果你压根就没有建立规则，他们使用内建的规则，其中的一个内建规则就是运行Linker，找到 程序名.o 结尾文件去产生一个可执行文件。

所以，make会去到名为love.o的文件。但make并不会止步于此。即使它找到了.o文件，它还有一组规则确保.o文件是最新的。换句话说，就是比源代码文件要新。在Linux系统中，最常的源代码是用C语言所编写的以.c为后缀的文件。

如果make同时找到了.c文件(love.c)和.o文件，它会查看它们俩的时间戳来确保.o文件更加新一些，如果没有.c文件新，或是.o文件不存在，make会使用另一组内建的规则用.c文件(使用C compiler)构建一个新的.o文件。对其它类型的编程也会采用相同的规则。最终当make运行完成后，会有一个最新的可执行程序生成。

顺便提一个Unix上的笑话，来自于早期版本make。当make找不到所需的文件时，例如没有love.o,love.c或其它格式的源代码文件，make程序会说： 

`make: don’t know how to make love. Stop.`

再回到正题，通常make使用当前目录下的Makefile。如果你有一个程序源代码文件，那边有Makefile，你可以看一看。他就内容就是普通文本。单词后跟冒号行就是目标(target)，也就是你紧随make命令之后输入的东西。make根据你的不同输入执行一些不同的操作。如果你只是输入make而不跟随任何命令，第一个目标将会被执行。

在大多数make文件的开头部分，你最有可能见到的是一些类似赋值的语句。每行有很多字段，字段间用等号相连。它们用来设置make的内部变量。常见的设置如C compiler的位置，程序的版本号，等类似的东西。

现在是回到谈configure的时候了。在不同的系统中C compiler可能位于不同的位置，你可能使用zsh而不是bash作为你的shell，程序可能需要知道你的主机名，可能会使用dbm库，需要知道系统中安装的是gdbm库，还是ndbm库，等等，等等。为了完成这些配置，时常需要修改Makefile。另外一个让程序员痛苦的是：任何时候你想要在一个新的系统中安装软件，你都需要重新列举出这些配置。

伴随着越来越多的软件被开发出来，更多兼容POSIX系统出现，这些配置的工作越来越难做。这时configure出现了。它是一个shell脚本(通常用GNU Autoconf来编写)，它来寻找一些工具的位置，试图看这些工具是否可以工作。之后便按照Makefile.in文件的指示生成可能在当前系统中工作Makefile(可能还有别的文件)。

背景知道介绍完了，让我们总结一下吧：

1. 你运行configure(通常你在shell中输入./configure)，这会生成一个新的Makefile文件。
2. 键入make命令，构建程序。他会在Makefile中找到第一个target，根据第一个target的说明来构建可执行文件。这步的目的就是生成一个可执行文件。
3. 现在，以root的身份键入make install。再次调用make找到一个名为install的target，根据这个target指定的文件和目录安装软件。
 

这是一个简化了的解释，但在大多数情况下，你知道这些就足够了。大多数程序都会有一个名为INSTALL的文件，这个文件包含了安装步骤，和一些注意事项。比如，提供一些选项给configure命令来改变最终可执行文件的目录。同时还会有其它的make target，诸如clean，用来在安装完成后执行一些清理工作。还有些时候会有test这个target，允许你在make和make install这两个步骤之间测试生成的可执行软件。

-----

原文网址：

http://tldp.org/LDP/LG/current/smith.html
